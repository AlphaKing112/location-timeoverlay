<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Overlay</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      color: white;
      background: transparent;
    }
    #overlay {
      padding: 10px;
      font-weight: bold;
      text-shadow: 2px 2px 6px #000;
      user-select: none;
      font-size: 20px;
      line-height: 1.6;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .emoji {
      font-size: 20px;
    }
  </style>
</head>
<body>
  <div id="overlay">
    <div class="row"><span class="emoji">🕒</span><span id="time">--:--</span></div>
    <div class="row"><span class="emoji">🗺️</span><span id="location">Loading...</span></div>
    <div class="row"><span class="emoji">🌥</span><span id="condition">--</span></div>
    <div class="row"><span class="emoji">🌡</span><span id="temperature">--°F</span></div>
  </div>

 <script>
  async function updateOverlay() {
    const timeEl = document.getElementById("time");
    const locationEl = document.getElementById("location");
    const conditionEl = document.getElementById("condition");
    const tempEl = document.getElementById("temperature");

    const openWeatherApiKey = "e9b4f16a2a8f9f682f961e4c5c9abbe2";

    const storedCity = localStorage.getItem("city") || "Los Angeles";
    const country = "USA"; // Default or could be editable later

    try {
      // 1. Get latitude, longitude from OpenWeather geolocation API
      const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(storedCity)},${country}&limit=1&appid=${openWeatherApiKey}`);
      const geoData = await geoRes.json();
      if (!geoData.length) throw new Error("City not found");

      const lat = geoData[0].lat;
      const lon = geoData[0].lon;
      const region = geoData[0].name;

      // 2. Get timezone from IPAPI (optional: replace with city-based lookup later)
      const tzRes = await fetch("https://ipapi.co/json/");
      const tzData = await tzRes.json();
      const timezone = tzData.timezone;

      // 3. Get weather
      const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=imperial&appid=${openWeatherApiKey}`);
      const weatherData = await weatherRes.json();

      const tempF = Math.round(weatherData.main.temp);
      const condition = capitalize(weatherData.weather[0].description);

      // 4. Live clock using fetched timezone
      setInterval(() => {
        const now = new Date();
        try {
          const formattedTime = new Intl.DateTimeFormat("en-US", {
            hour: "numeric",
            minute: "2-digit",
            second: "2-digit",
            hour12: true,
            timeZone: timezone
          }).format(now);
          timeEl.textContent = formattedTime;
        } catch (e) {
          timeEl.textContent = "--:--";
        }
      }, 1000);

      // 5. Update other UI
      locationEl.textContent = `${region}, ${country}`;
      conditionEl.textContent = condition;
      tempEl.textContent = `${tempF}°F`;
    } catch (e) {
      console.error("Error updating overlay:", e);
      locationEl.textContent = "Unable to load location.";
      conditionEl.textContent = "--";
      tempEl.textContent = "--°F";
    }

    function capitalize(text) {
      return text.charAt(0).toUpperCase() + text.slice(1);
    }
  }

  updateOverlay();
</script>

</body>
</html>
